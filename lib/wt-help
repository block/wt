#!/usr/bin/env bash
#
# wt-help — Help text for the wt command
# ======================================
#
# This file provides the help text for the unified wt command.
# It is sourced by wt.sh.
#

# Display help for the wt command
wt_show_help() {
  # Force reload config to pick up context changes in current shell
  wt_read_config "$HOME/.wt/current" "force" 2>/dev/null || true
  wt_read_git_config

  # Use WT_CONTEXT_NAME if set, otherwise empty
  local current_context="${WT_CONTEXT_NAME:-}"

  cat <<'EOF'
wt — Unified Worktree Toolkit

Usage: wt <command> [args]

Worktree Commands:
  add <branch>              Create a new worktree for a branch
  switch [worktree]         Switch the active worktree symlink
                            - interactive worktree selection if omitted
  remove [worktree]         Remove a worktree
                            - interactive worktree selection if omitted
                            - use --merged to remove all merged-branch worktrees
  list [-v]                 List all worktrees with status
                            - use -v for dirty/ahead/behind indicators
  cd [worktree]             Change directory to a worktree
                            - interactive worktree selection if omitted

Context Commands (multi-repo support):
  context                   Interactive: pick repository context to switch to
  context <name>            Switch to named repository context
  context --list            List all available contexts
  context add               Add a new repository context (interactive)
  context add <path>        Add context for repository at path
  context add <name> <path> Add context with specific name and path

Metadata Commands:
  metadata-export [src] [vault] Export project metadata to vault
                                - src: source repo (default: $WT_MAIN_REPO_ROOT)
                                - vault: metadata vault (default: $WT_IDEA_FILES_BASE)

  metadata-import [wt]          Import project metadata into a worktree
  metadata-import [vault] [wt]  - wt: target worktree (interactive if omitted)
                                - vault: metadata vault (default: $WT_IDEA_FILES_BASE)

  ijwb-export, ijwb-import      Legacy aliases for metadata commands

Other:
  help                      Show this help message

Examples:
  wt add feature/my-feature       # Create worktree for new branch
  wt switch                       # Interactive: pick worktree to link
  wt cd                           # Interactive: cd to selected worktree
  wt list                         # Show all worktrees (fast)
  wt list -v                      # Show worktrees with dirty/ahead/behind
  wt remove                       # Interactive: remove a worktree
  wt remove --merged              # Remove all worktrees with merged branches

  wt context                      # Switch to a different repository
  wt context java                 # Switch to 'java' context
  wt context add ~/code/myrepo    # Add a new repository context

  wt metadata-export              # Export using default paths
  wt metadata-export ~/repo ~/vault
  wt metadata-import              # Interactive: pick worktree to import into
  wt metadata-import ~/worktree   # Import into specific worktree

EOF

  # Show context info if configured
  if [[ -n "$current_context" ]]; then
    cat <<EOF
Current Context: $current_context
EOF
  fi

  cat <<EOF

Configuration (from ${current_context:-"defaults"}):
  WT_MAIN_REPO_ROOT     Main repository root
                        [current: $WT_MAIN_REPO_ROOT]
  WT_WORKTREES_BASE     Directory where worktrees are created
                        [current: $WT_WORKTREES_BASE]
  WT_IDEA_FILES_BASE    Project metadata vault location
                        [current: $WT_IDEA_FILES_BASE]
  WT_ACTIVE_WORKTREE    Symlink path for active worktree
                        [current: $WT_ACTIVE_WORKTREE]
  WT_BASE_BRANCH        Default branch for new worktrees
                        [current: $WT_BASE_BRANCH]
  WT_METADATA_PATTERNS  Patterns to preserve (space-separated)
                        [current: $WT_METADATA_PATTERNS]
EOF
}
